define(["jquery","search","modal","cookie","requestAjax","realTimeSocket","realTime/notificationSound","device","editor","setNumNotification"],function(u,e,t,n,a,o,r,i,s,l){"use strict";var c,d=!1,h=!0;u(window).on("blur",function(){h=!1}).on("focus",function(){h=!0});var g=function(){this.$element=null,this.$chatBlock=null,this.processing=!1,this.data=!1,this.allow=!1,this.class={dialog:{id:"#dialog-list",container:".dialog-list",item:".dialog-list-{id}",chat:".dialog-{id}"},chat:{item:"#chat-{id}"},photos:{container:"#message-photos",block:"#message-photos-list"}},this.realIntervalId=null,this.$dialogCount=null,this.chatIntervalId=[],this.$typing=u('<div class="d-flex container-fluid justify-content-start message-typing-container">                            <div class="media-body" data-toggle="tooltip" data-placement="top" title="">                                <div class="message-typing">                                    <div class="message-typing-dot"></div>                                    <div class="message-typing-dot"></div>                                    <div class="message-typing-dot"></div>                                </div>                            </div>                        </div>')};g.prototype={init:function(e){this.$element=u(e),this.$chatBlock=this.$element.closest(".chat-block"),this.formData(),this.ajax()},formData:function(){var a=this,i=new FormData;u.each(this.$element.find('[type="file"]'),function(e,t){u(this).val()&&(a.allow=!0),u.each(t.files,function(e,t){i.append("un_user_message[files]["+e+"][dialogFile]",t)})});var e=this.$element.find('[name="un_user_message[body]"]').val();i.append("un_user_message[body]",e),u.trim(e).length&&(this.allow=!0);var t=this.$element.find('[name="un_user_message[ids]"]').val();i.append("un_user_message[ids]",t);var s=this.$element.find('[name="un_user_message[_token]"]').val();i.append("un_user_message[_token]",s),this.data=i},ajax:function(){this.allow&&(this.setProcessing(!0),u.ajax({url:this.$element.attr("action"),method:this.$element.attr("method"),dataType:"json",data:this.data,cache:!1,contentType:!1,processData:!1}).then(u.proxy(this.response,this)).catch(u.proxy(this.catch,this)))},catch:function(){this.setProcessing(!1)},response:function(e){if(this.setProcessing(!1),"success"===e.status){var t,a={relatedTarget:this,response:e};if(this.$element.trigger(t=u.Event("chat.un.show",a)),t.isDefaultPrevented())return;this.$element.find(".message-form-text").html(""),this.$element.find('[name="un_user_message[body]"]').val(""),this.formValue(this.$element.find(".message-form-text")),e.url?window.location.href=e.url:(this.responseContent(e),this.responseRealTime(e))}},responseContent:function(l,e,c){var d=e||u(".dialog-"+l.id),h={relatedTarget:this,response:l,container:d};if(d.each(function(){var e,t=u(this),a=u(l.content),i=t.children(".msg").last();if(i.hasClass(c?"justify-content-start":"justify-content-end")&&a.hasClass(c?"justify-content-start":"justify-content-end")){var s=new Date(a.find("[datetime]").attr("datetime")),n=new Date(i.find("[datetime]").attr("datetime"));n.setMinutes(n.getMinutes()+5),n.valueOf()>=s.valueOf()&&(i.removeClass("mb-2 pb-2").addClass("mb-1"),i.find(".chat-message").addClass(c?"chat-message-radius-bottom-left":"chat-message-radius-bottom-right"),a.find(".chat-message").addClass(c?"chat-message-radius-top-left":"chat-message-radius-top-right"),c&&i.find(".chat-message-image img").addClass("d-none"))}if(t.find(".seen-block").remove(),t.find(".message-typing-container").remove(),e=a.find("img").length,a.addClass("invisible"),t.append(a),e){var o=!1,r=null;a.imagesLoaded({complete:function(){!1===o&&(window.clearTimeout(r),o=!0,t.scrollTop(t[0].scrollHeight),a.removeClass("invisible"),d.trigger(u.Event("chat.un.shown",h)))}.bind(this)}),r=window.setTimeout(function(){!1===o&&(o=!0,t.scrollTop(t[0].scrollHeight),a.removeClass("invisible"),d.trigger(u.Event("chat.un.shown",h)))}.bind(this),3e3)}else t.scrollTop(t[0].scrollHeight),a.removeClass("invisible"),d.trigger(u.Event("chat.un.shown",h))}),-1!=window.location.pathname.search("messages")){var t=u(this.class.photos.container),a=u(this.class.photos.block),i=u(this.class.dialog.container);l.photosList&&a.length?a.prepend(l.photosList):l.photosContainer&&t.length&&t.html(l.photosContainer),c||l.dialogList&&i.length&&(u(this.class.dialog.item.replace("{id}",l.id),i).remove(),i.prepend(l.dialogList))}},responseRealTime:function(t){window.clearTimeout(c),d=!1,o.emit("typing",{room:t.id,container:this.class.dialog.chat.replace("{id}",t.id),typing:d}),o.emit("dialog",{room:t.id,dialogId:t.id,container:this.class.dialog.chat.replace("{id}",this.$chatBlock.data("dialog-id")),urlMessage:t.urlMessage}),t.users&&t.users.forEach(function(e){o.emit("dialogNotice",{room:e.id,user:e,fromUser:user,response:t})})},seen:function(e){o.emit("seen",{room:e,user:user,container:this.class.dialog.chat.replace("{id}",e)})},formValue:function(e){0<e.text().length?(e.data("placeholder")||e.data("placeholder",e.parent().children(".form-placeholder").clone()),e.parent().children(".form-placeholder").remove()):e.parent().prepend(e.data("placeholder")),e.closest("form").find('[name="un_user_message[body]"]').val(e.text())},reloadScroll:function(e){e.each(function(){u(this).is(":visible")&&u(this).data("LoadedScrollAjax")&&u(this).data("LoadedScrollAjax").scroll()})},isProcessing:function(){return!0===this.processing},setProcessing:function(e){this.processing=!0===e},setDialogCount:function(e){this.$dialogCount||(this.$dialogCount=document.querySelectorAll('[data-dialog-count="all"]')),this.$dialogCount&&new l(this.$dialogCount,e)}},u.extend(g.prototype,{realTyping:function(e){var t;e.container&&(t=u(e.container)),t.length&&(u(".message-typing-container .media-body",this.$typing).tooltip("hide").tooltip("dispose"),this.$typing.remove(),e.typing&&(u('[data-toggle="tooltip"]',this.$typing).attr("title",e.message),t.each(u.proxy(function(e,t){var a=u(t);a.append(this.$typing),a.scrollTop(a[0].scrollHeight)},this))))},realUpdateDialog:function(e){var t=u(this.class.dialog.container);e.urlDialog&&t.length&&this.realUpdateDialogAjax(t,e)},realUpdateDialogAjax:function(e,t){var a={relatedTarget:this};e.trigger(u.Event("dialog.un.show",a)),u.ajax({dataType:"json",url:t.urlDialog,method:"POST",data:{active:u(this.class.dialog.id).children(this.class.dialog.item.replace("{id}",t.id)).hasClass("active")}}).then(u.proxy(function(i){"success"===i.status&&(e.each(u.proxy(function(e,t){var a=u(t);a.children(this.class.dialog.item.replace("{id}",i.id)).remove(),a.prepend(i.content)},this)),h?this.reloadScroll(e):(u(window).off("focus.real.dialog_list"),u(window).one("focus.real.dialog_list",u.proxy(function(){this.reloadScroll(e)},this))),e.trigger(u.Event("dialog.un.shown",a)))},this))},realSetTitle:function(e){document.body.hasAttribute("data-title")||document.body.setAttribute("data-title",document.title),window.clearInterval(this.realIntervalId),this.realIntervalId=window.setInterval(function(){document.body.getAttribute("data-title")===document.title?document.title=e.numSeenTitleTrans:document.title=document.body.getAttribute("data-title")},1e3),u(window).off("focus.real.title"),u(window).one("focus.real.title",u.proxy(function(){window.clearInterval(this.realIntervalId),document.body.hasAttribute("data-title")&&(document.title=document.body.getAttribute("data-title"))},this))},realDialogNotice:function(e){var t=e.response,a=e.user,i=u(this.class.dialog.chat.replace("{id}",t.id)),s=u(this.class.chat.item.replace("{id}",t.id));i.length&&h||this.realUpdateDialog(t),!h&&0<a.numDialogSeen&&this.realSetTitle(a),(!h||!s.length&&window.location.pathname.search("messages")<0||s.length&&!s.hasClass("focus"))&&this.setDialogCount(a.numDialogSeen),s.length&&(h&&s.hasClass("focus")||this.realSetFocusChat(s,t)),i.length||new r("msg"),u(document).on("chat.un.shown",function(){new r("msg")})},realSetFocusChat:function(e,t){var a=e.find(".message-form-text"),i={relatedTarget:this,response:t};this.chatIntervalId.indexOf(t.id)<0&&(this.chatIntervalId.push(t.id),this.chatIntervalId[t.id]=null),a.off("focus.un.chat_header"),a.one("focus.un.chat_header",u.proxy(function(){window.clearInterval(this.chatIntervalId[t.id]),e.trigger(u.Event("chat.un.seen",i))},this)),window.clearInterval(this.chatIntervalId[t.id]),this.chatIntervalId[t.id]=window.setInterval(function(){e.children(".card-header").hasClass("hover")?e.children(".card-header").removeClass("hover"):e.children(".card-header").addClass("hover")},800)},realSeen:function(a){var i=new Date;a.container&&u(a.container).each(function(){var e=u(this).find(".seen-"+a.user.id),t=e.data("title").replace("%time%",i.getHours()+":"+i.getMinutes());e.attr("title",t),e.attr("alt",t),e.removeClass("d-none"),u(this).scrollTop(this.scrollHeight)})},realDialog:function(t){t.container&&t.urlMessage&&u.ajax({dataType:"json",method:"POST",url:t.urlMessage}).then(u.proxy(function(e){this.realResponse(e,t.container)},this))},realResponse:function(e,t){var a=u(t);this.responseContent(e,a,!0)},friendNotice:function(e){var t=e.id,a=u("#chat-friend-"+t);a.length&&(a.find(".online-indicator").removeClass("d-none"),a.find(".not-online").addClass("d-none"),a.parent().prepend(a),u("#chat-panel-online-indicator").removeClass("d-none"),u("#chat-block").children("[data-dialog-uid]").each(function(){0<=u(this).data("dialog-uid").indexOf(t)&&u("#online-indicator-"+u(this).closest(".chat-block").data("dialog-id")).removeClass("d-none")}))}});var m=new g;function f(e){var t=e.children(".mini-chat");if(t.length){var a=t.length,i=u(window).width(),s=t.outerWidth(!0)+parseInt(e.css("right"))+2*a;(5<=a||i<=s*a)&&e.children(".chat-block").first().find(".mini-chat-close").trigger("click")}}return u(document).on("submit",'form[name="un_user_message"]',function(e){e.preventDefault(),u(this).find('[name="un_user_message[save]"]').hasClass("disabled")||m.isProcessing()||m.init(this)}).on("keydown",".message-form-text",function(e){13!=e.which||e.shiftKey&&13==e.which||(e.preventDefault(),u(this).closest("form").trigger("submit"))}).on("keypress",".message-form-text",function(e){var t,a=u(this),i=a.closest(".chat-block");(32===e.which||8===e.which||47<e.which&&e.which<113&&93!==e.which||145<e.which)&&(window.clearTimeout(c),d||(d=!0,t={room:i.data("dialog-id"),container:m.class.dialog.chat.replace("{id}",i.data("dialog-id")),message:a.data("chat-user-typing"),username:user.username,avatar:user.avatar,typing:d},o.emit("typing",t)),c=window.setTimeout(function(){d=!1,t={room:i.data("dialog-id"),container:m.class.dialog.chat.replace("{id}",i.data("dialog-id")),typing:d},o.emit("typing",t)},8e3))}).on("keyup",".message-form-text",function(){var e;(e=u(this).closest("form").find('[name="un_user_message[save]"]')).hasClass("b-disabled")?""!==u(this).text()?e.removeClass("disabled"):e.addClass("disabled"):""!==u(this).text()?e.removeClass("d-none"):e.addClass("d-none")}).on("change",'form[name="un_user_message"] [type="file"]',function(){u(this).closest("form").trigger("submit")}).on("focus",".mini-chat",function(){u(this).addClass("focus"),u(this).children(".card-header").addClass("card-primary btn-primary")}).on("focus",".mini-chat-inner",function(){"ontouchstart"in document.documentElement||(u(this).addClass("focus"),u(this).closest(".mini-chat").find(".message-form-text").trigger("focus"))}).on("blur",".mini-chat",function(){u(this).removeClass("focus"),u(this).children(".card-header").removeClass("card-primary").removeClass("btn-primary")}).on("keydown",".message-form-text",function(e){if(e.ctrlKey&&86===e.which){if(0<u(this).text().length)return s.pasteHtmlAtCaret(e.target.textContent),!1;setTimeout(u.proxy(function(){u(this).html(u(this).text())},this),10)}}).on("keyup keypress",".message-form-text",function(){var e=u(this);m.formValue(e)}),u(document).on("requireajax.un.show","#chat-visibility",function(e){var t=u(e.target),a=u(t.data("target"));a.hasClass(t.data("target-class"))?a.removeClass(t.data("target-class")):a.addClass(t.data("target-class"))}).on("click",".mini-chat.slide-down .chat-panel-expand",function(e){e.preventDefault();var t=u("#chat-visibility");t.length&&t.trigger("click")}),u(document).on("requireajax.un.show",".open-chat",function(e){var t=e.response;t.id&&(u("#chat-"+t.id).length?(e.preventDefault(),u("#chat-"+t.id).find(".message-form-text").trigger("focus")):setTimeout(function(){u("#chat-"+t.id).find(".message-form-text").trigger("focus")},500))}).on("requireajax.un.shown","#chat-block",function(e){var t=e.response;t.id&&1<u(".chat-"+t.id).length&&u(".chat-"+t.id).first().remove()}).on("keyup keypress keydown",".mini-chat .message-form-text",function(e){var t=u(this).closest(".chat-block"),a=t.find(".chat"),i=t.find(".card-header"),s=t.find(".chat-footer"),n=t.outerHeight(!0)-i.outerHeight(!0)-s.outerHeight(!0)-2;a.height(n)}).on("chat.un.shown",function(e){var t=u(m.class.chat.item.replace("{id}",e.response.id)),a=t.find(".chat"),i=t.find(".card-header"),s=t.find(".chat-footer"),n=t.outerHeight(!0)-i.outerHeight(!0)-s.outerHeight(!0)-2;a.height(n)}).on("click",".mini-chat-close",function(){var e=u(this),t=e.closest(".mini-chat");e.tooltip("hide").children('[data-toggle="tooltip"]').tooltip("hide"),e.tooltip("dispose").children('[data-toggle="tooltip"]').tooltip("dispose");var a=t.data("dialog-init");if(a){var i={relatedTarget:this,id:t.data("dialog-id")};e.trigger(u.Event("close.un.chat",i)),t.remove();var s=n.getJSON("chat");s&&(s.splice(s.indexOf(a),1),u(".mini-chat-close").length?(n.remove("chat"),n.set("chat",s,{expires:1/48})):n.remove("chat"))}else t.remove()}).on("click","#close-all-mini-chat",function(){u(".mini-chat-close").trigger("click")}).on("requireajax.un.shown","#chat-block",function(e){var t=e.response,a=t.users;if(a)for(var i in a)if(a[i].id!=user.id&&a[i].isOnline){u("#online-indicator-"+t.id).removeClass("d-none");break}}).on("requireajax.un.shown","#chat-block",function(e){f(u(e.target))}).on("requireajax.un.shown","#chat-block",function(e){var t=e.response,a=n.getJSON("chat");a&&t.id?a.indexOf(t.id)<0&&a.push(t.id):t.id&&(a=[t.id]),a&&(n.remove("chat"),n.set("chat",a,{expires:1/48}))}).on("requireajax.un.shown",".chat-panel .chat",function(e){var t=u(e.target),i=e.response,a=!1;t.children().each(function(){u(this).find(".online-indicator").hasClass("d-none")||(t.prepend(u(this)),a=!0)}),0<i.onlineFriendsId.length&&a?u("#chat-panel-online-indicator").removeClass("d-none"):u("#chat-panel-online-indicator").addClass("d-none"),u("#chat-block").children("[data-dialog-uid]").each(function(){var e=u(this).data("dialog-uid"),t=!1;for(var a in e)if(0<=i.onlineFriendsId.indexOf(e[a])){t=!0;break}t?u("#online-indicator-"+u(this).closest(".chat-block").data("dialog-id")).removeClass("d-none"):u("#online-indicator-"+u(this).closest(".chat-block").data("dialog-id")).addClass("d-none")})}).on("requireajax.un.shown",".chat-panel .chat",function(e){var t=e.response,a=new Date(t.user.lastLogin),i=new Date;if(a.setSeconds(a.getSeconds()+10),t&&t.onlineFriendsId&&a.valueOf()>i.valueOf())for(var s in t.onlineFriendsId)o.emit("friendNotice",{room:t.onlineFriendsId[s],id:t.user.id})}),u(document).on("requireajax.un.shown",".chat",function(e){if(e.response.id){var t=u(this);if(!t.parent().children(".unread-messages").length){var a=t.data("count");if(a){var i=u('<div class="unread-messages w-100">                                <span class="d-flex justify-content-center">                                    <span class="unread-messages-bg py-1 px-2 d-flex align-items-center" role="button">                                        <svg class="icon icon-arrow-up rounded-circle icon-t-0 mr-1">                                            <use xlink:href="#icon-arrow-up"></use>                                        </svg> <span class="small">'+t.data("unread-text")+' <span class="unread-messages-text">'+a+"</span></span>                                    </span>                                </span>                            </div>");i.hide(),t.parent().prepend(i),window.setTimeout(function(){var e=t.data("count");!isNaN(e)&&0<e?i.show():i.remove()},5e3)}}}}).on("loadedscroll.un.visible.ajax",".chat",function(e){var t=e.response;m.setDialogCount(t.numDialogSeen)}).on("loadedscroll.un.visible.ajax",".chat",function(e){var t=e.response;m.realUpdateDialog(t)}).on("loadedscroll.un.visible.read",".chat",function(e){var t=u(e.target),a=t.closest(".chat-block").data("dialog-id"),i=parseInt(t.data("count"))-1;if(t.closest(".mini-chat").length&&!t.is(":hover")&&!t.closest(".chat-block").find(".message-form-text").is(":focus")){e.preventDefault();var s=t.closest(".chat-block").find(".message-form-text");return s.off("focus.chat_read"),void s.one("focus.chat_read",function(){m.reloadScroll(t)})}if(!t.closest(".mini-chat").length&&(u(window).off("focus.chat_read"),!h))return e.preventDefault(),void u(window).one("focus.chat_read",function(){m.reloadScroll(t)});!isNaN(i)&&a&&(i<=0&&(u(m.class.dialog.chat.replace("{id}",a)).parent().find(".unread-messages").remove(),i=0),u(m.class.dialog.chat.replace("{id}",a)).each(function(){u(this).data("count",i),u(this).attr("data-count",i),u(this).parent().find(".unread-messages .unread-messages-text").text(i)}),m.seen(a))}).on("loadedscroll.un.visible.read",".chat",function(e){var t=u(e.target).closest(".chat-block").data("dialog-id");e.item.is(":last-child")&&u(m.class.dialog.item.replace("{id}",t)).each(function(){u(this).removeClass("not-read")})}).on("click",".unread-messages",function(e){e.preventDefault();var t=u(this).closest(".chat-block").find("[data-loaded]");t.animate({scrollTop:t.children().first().offset().top-t.offset().top+t.scrollTop()})}),u(document).on("requireajax.un.start",".btn-message-info",function(e){if(!(a=u(e.target)).hasClass("disabled")){var t=document.querySelector(e.target.getAttribute("data-block")),a=document.querySelector(e.target.getAttribute("data-target"));t.classList.contains("d-xl-block")?t.classList.remove("d-xl-block"):t.classList.add("d-xl-block"),a.classList.contains("col-xl-8")?(a.classList.remove("col-xl-8"),a.classList.add("col-xl-12")):(a.classList.remove("col-xl-12"),a.classList.add("col-xl-8"))}}),u(document).on("requireajax.un.start",m.class.dialog.container+" .list-group-item",function(e){var t=u(e.target).data("dialog-id");(u('[data-dialog-id="'+t+'"]').hasClass("active")||u(m.class.chat.item.replace("{id}",t)).length)&&e.preventDefault()}).on("requireajax.un.show",m.class.dialog.id+" .list-group-item",function(e){var t=u(e.target),a=t.data("dialog-id"),i=t.parent(),s={relatedTarget:this,id:i.children(".active").data("dialog-id")};t.trigger(u.Event("active.un.dialog_list",s)),i.children(".active").removeClass("active"),i.children('[data-dialog-id="'+a+'"]').addClass("active")}).on("requireajax.un.show",m.class.dialog.container+" .list-group-item",function(e){var t=u(e.target);setTimeout(function(){u(m.class.dialog.chat.replace("{id}",t.data("dialog-id"))).closest(".chat-block").find(".message-form-text").trigger("focus")},100)}).on("requireajax.un.start",m.class.dialog.id+" .list-group-item",function(e){u(this).hasClass("active")&&e.preventDefault()}).on("requireajax.un.show",".message-new-btn",function(){u(m.class.dialog.container+" .list-group-item").removeClass("active")}).on("requireajax.un.start",m.class.dialog.container+" .open-chat",function(e){var t=u(e.target),a=e.relatedTarget;if(-1==window.location.pathname.search("messages")){if(window.devicejs.isMobile)return e.preventDefault(),void(window.location.href=t.data("replace-url"));a.options.container=t.data("ajax-container-open-chat"),a.options.params.url=t.data("ajax-open-chat-url"),a.options.params.data={type:"dialog"},a.options.append="prepend",a.options.replaceUrl=!1}}),u(document).on("loadedscroll.un.visible.ajax",m.class.dialog.container,function(e){var t=e.response;t.id&&Array.isArray(t.id)&&m.setDialogCount(t.numDialogSeen)}).on("requireajax.un.shown",".chat",function(e){var t=u(e.target),a=e.response;-1!=window.location.pathname.search("messages")||t.closest(".chat-block").find(".message-form-text").is(":focus")||t.children().last().data("read")&&m.realSetFocusChat(t.closest(".mini-chat"),a)}),u(document).on("focus",".dialog-search-input",function(){u(this).removeClass("text-center")}).on("blur",".dialog-search-input",function(){u(this).addClass("text-center")}),u(document).on("click",".message-search-btn",function(){u(".search-message").toggleClass("d-none"),u("#message-search-input").parent().find(".search-close").trigger("click"),u(this).trigger(u.Event("search_messages.un.dialog"))}).on("search.un.start","#message-search-input",function(e){var t=u(e.target);u(t.data("search-container")).data("LoadedScrollAjax").destroy(),u(t.data("search-container")).css("padding-top","91px")}).on("search.un.shown","#message-search-input",function(e){var t=e.search;t.parent().children(".unread-messages").remove(),t.scrollTop(t.get(0).scrollHeight);var a,i=t.find("img").length,s=null;i&&(a=!1,t.imagesLoaded({complete:function(){!1===a&&(window.clearTimeout(s),a=!0,t.scrollTop(t.get(0).scrollHeight))}.bind(this)}),s=window.setTimeout(function(){!1===a&&(a=!0,t.scrollTop(t.get(0).scrollHeight))}.bind(this),3e3))}).on("search.un.closed","#message-search-input",function(e){var t=e.search;t.data("LoadedScrollAjax").scroll(),t.siblings(".result-message").remove(),t.css("padding-top",0)}).on("search.un.shown","#message-search-input",function(e){var t=u(e.target),a=e.search,i=t.data("intl-translation"),s=e.response;if(i=(i=(i=i.replace(/{selected_index}/g,s.search.selected_index)).replace(/{total_count}/g,s.search.total_count)).replace(/{query_name}/g,s.word),a.siblings(".result-message").remove(),!(s.search.selected_index<=0)){var n="",o="";s.search.total_count<=1&&(o=n="disabled"),s.search.selected_index<=1&&(o="disabled"),s.search.selected_index>=s.search.page_count&&(n="disabled");var r=s.search.selected_index<s.search.page_count&&s.search.selected_index+1,l=1<s.search.selected_index&&s.search.selected_index-1;a.after('<div class="result-message" style="padding-top: 55px">                        <div class="col-12">                            <div class="d-flex bo-b-1 p-2 justify-content-center small">                                <span class="btn p-0 btn-link search-message-btn '+n+'" role="button" data-page="'+r+'">                                    <svg class="icon icon-arrow-up wh-4">                                        <use xlink:href="#icon-arrow-up"></use>                                    </svg>                                </span>                                <span class="btn p-0 btn-link search-message-btn '+o+'" role="button" data-page="'+l+'">                                    <svg class="icon icon-arrow-down wh-4">                                        <use xlink:href="#icon-arrow-down"></use>                                    </svg>                                </span>                                <span>'+i+"</span>                            </div>                        </div>                    </div>")}}).on("click",".search-message-btn",function(){var e=u("#message-search-input");u(this).hasClass("disabled")||(u(this).addClass("disabled"),e.data("SearchAjax").setParams({page:u(this).data("page")},{}),e.data("SearchAjax").send())}),u(document).on("toggle_class.start",m.class.dialog.id+" .list-group-item",function(e){var t=u(e.target),a=e.relatedTarget;t.hasClass("active")&&a.isOpen()||e.preventDefault()}).on("requireajax.un.show",m.class.dialog.id+" .list-group-item",function(e){var t=u(e.target);t.data("toggleClassInit")&&t.data("toggleClassInit").isOpen()&&t.trigger("click")}).on("search_messages.un.dialog",".m-message-search-btn",function(){u(".dialog-name-mobile").find("[data-toggle-class]").trigger("click"),u("#message-search-input").trigger("focus")}).on("requireajax.un.show",".m-message-new-btn",function(){u(".m-back-dialog").trigger("click")}).on("requireajax.un.show","#chat-block",function(e){(window.devicejs.isMobile||window.devicejs.isTablet)&&e.preventDefault()}).on("requireajax.un.start requireajax.un.show","#begin-list-friends",function(e){(window.devicejs.isMobile||window.devicejs.isTablet)&&e.preventDefault()}),u(document).on("click",'.tooltip [role="button"]',function(){var e=u(this).closest(".tooltip").attr("id");u('[aria-describedby="'+e+'"]').tooltip("hide").tooltip("dispose")}),u(window).on("resize.un.chat",function(){var e=u("#chat-block");e.length?f(e):u(window).off("resize.un.chat")}),u(function(){var t=n.getJSON("chat");t&&setTimeout(function(){for(var e in t)t[e]&&new a({element:null,container:"#chat-block",params:{url:baseOptions.url+"profile/messages/"+t[e]+"/openchat",data:{type:"dialog"}},append:"prepend"}).ajax()},1e3)}),m});