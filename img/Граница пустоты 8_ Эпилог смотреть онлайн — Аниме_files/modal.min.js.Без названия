define(["jquery","loader","bootstrap"],function(l,n){"use strict";var h=function(t,e){this.options=l.extend({},h.Default,t),this.$element="object"==typeof this.options.element?this.options.element:l(this.options.element),this.content=e||"",this.html={header:'                <div class="modal-header">                    <h5 class="modal-title"></h5>                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">                        <span aria-hidden="true">&times;</span>                    </button>                </div>',body:'                <div class="modal fade" role="dialog">                    <div class="modal-dialog" role="document">                        <div class="modal-content">                            <div class="modal-body"></div>                        </div>                    </div>                </div>',footer:{confirm:'                        <div class="modal-footer">                            <button type="button" class="btn btn-primary" data-dismiss="action" role="button">'+this.options.button.save+'</button>                            <button type="button" class="btn btn-secondary" data-dismiss="modal" role="button">'+this.options.button.cancel+"</button>                        </div>",alert:'                    <div class="modal-footer">                        <button type="button" class="btn btn-primary" data-dismiss="modal" role="button">'+this.options.button.save+"</button>                    </div>"}},this.$container=!1,this.processing=!1,this.init()};return h.Default={element:null,url:!1,ajax:!1,requestMethod:"GET",dataType:"json",data:{},append:!1,replaceUrl:!1,header:!1,modal:!1,button:{save:"Ok",cancel:"Cancel"},loader:{id:!1,idloader:"uloader",overlay:!0,params:{}},backdrop:!0,keyboard:!0,focus:!0,show:!0,size:"",target:"popup-modal"},h.prototype={init:function(){this.isProcessing()||(!this.content&&null!==this.$element&&this.$element.attr("data-modal-content")&&(this.content=this.$element.attr("data-modal-content")),this.createModal(),this.options.ajax&&!this.content?(this.setProcessing(!0),this.show()):this.content&&this.show(),this.$container.on("shown.bs.modal",this.shown.bind(this)),this.$container.on("submit",this.dismissAction.bind(this)),this.$container.on("click.un.modal",'[data-dismiss="action"]',this.sendForm.bind(this)),this.$container.on("hidden.bs.modal",this.hidden.bind(this)))},sendForm:function(){this.$container.find('[type="submit"]').length?this.$container.find('[type="submit"]').trigger("click"):this.$container.find("form").trigger("submit")},ajax:function(){var t,e=this;this.options.url&&(t={url:this.options.url,method:this.options.requestMethod,dataType:this.options.dataType,data:this.options.data},l.ajax(t).done(function(t){e.response(t)}).fail(function(){e.setProcessing(!1),console.log("error")}))},response:function(t){var e,n;if(this.setProcessing(!1),"success"===t.status){if(e={relatedTarget:this,response:t},this.$container.trigger(n=l.Event("show.un.modal",e)),n.isDefaultPrevented())return;if(this.options.append?this.$container.find(".modal-body").append(t.content):this.$container.find(".modal-body").html(t.content),this.options.header&&t.header)this.$container.find(".modal-title").html(t.header);else if(t.header){var o=l(this.html.header);o.find(".modal-title").html(t.header),this.$container.find(".modal-content").prepend(o)}"confirm"===this.options.modal?this.$container.find(".modal-content").append(this.html.footer.confirm):"alert"===this.options.modal&&this.$container.find(".modal-content").append(this.html.footer.alert),e={response:t,container:this.$container},this.$container.trigger(l.Event("shown.un.modal",e))}else this.$container.modal("hide"),new h({element:null,ajax:!1,append:!1,replaceUrl:!1,header:!!t.header&&t.header,modal:"alert",backdrop:!0,keyboard:!0,focus:!0,show:!0,size:"",target:"popup-modal"},t.message)},dismissAction:function(t){var e,n,o,i=l(t.target);t.preventDefault(),e={relatedTarget:this},this.$container.trigger(n=l.Event("action.un.modal.start",e)),n.isDefaultPrevented()||(o=i.serialize(),this.setProcessing(!0,!0),l.ajax({url:i.attr("action"),method:i.attr("method"),data:o}).done(l.proxy(this.dismissResponse,this)).fail(l.proxy(this.dismissFail,this)))},dismissFail:function(){this.setProcessing(!1),console.log("error")},dismissResponse:function(t){var e,n,o,i=this;if(this.setProcessing(!1),"success"===t.status){if(o={relatedTarget:!1},this.$element.data("ajax-second-container")&&t.contentSecond&&(n=l(t.contentSecond),this.$element.data("ajax-second-container-unwrap")&&n.length&&n.contents().unwrap(),n.length?l(this.$element.data("ajax-second-container")).html(n):l(this.$element.data("ajax-second-container")).html(t.contentSecond)),this.$element.data("ajax-container")&&t.content){if("object"==typeof this.$element.data("ajax-container")){var a,s=this.$element.data("ajax-container"),d=this.$element.data("ajax-container-unwrap");for(var r in s)l(s[r]).each(function(){a="object"==typeof t.content?l(t.content[r]).length?l(t.content[r]):t.content[r]:l(t.content).length?l(t.content):t.content,"object"==typeof d?d[r]&&a.contents().unwrap():d&&a.contents().unwrap(),"object"==typeof i.options.append&&i.options.append[r]?l(this).append(a):l(this).html(a)})}else this.options.append?l(this.$element.data("ajax-container")).append(t.content):l(this.$element.data("ajax-container")).html(t.content);this.$element.data("ajax-second-container")&&this.$element.data("ajax-second-container-remove")&&l(this.$element.data("ajax-second-container")).remove(),o={container:l(this.$element.data("ajax-container")),response:t}}this.options.replaceUrl&&(e=!0===this.options.replaceUrl&&t.url?t.url:!0===this.options.replaceUrl&&null!==this.$element&&this.$element.attr("href")?this.$element.attr("href"):this.options.replaceUrl),t.modal&&this.$container.find(".modal-body").html(t.content),e&&(history.replaceState(window.location.href,null,window.location.href),history.pushState(e,null,e)),this.$container.trigger(l.Event("action.un.modal.end",o)),t.modal||this.$container.modal("hide"),t.reload&&window.location.reload(),(t.message||t.content&&t.header)&&new h({element:null,ajax:!1,append:!1,replaceUrl:!1,header:!!t.header&&t.header,modal:"alert",backdrop:!0,keyboard:!0,focus:!0,show:!0,size:"",target:"popup-modal"},t.message?t.message:t.content)}else this.$container.modal("hide"),new h({element:null,ajax:!1,append:!1,replaceUrl:!1,header:!!t.header&&t.header,modal:"alert",backdrop:!0,keyboard:!0,focus:!0,show:!0,size:"",target:"popup-modal"},t.message?t.message:t.content)},shown:function(){this.options.ajax&&!this.content&&this.ajax(),"alert"!==this.options.modal&&"confirm"!==this.options.modal||this.$container.find("[data-dismiss]").trigger("focus")},hidden:function(){this.$container.remove()},isProcessing:function(){return!0===this.processing},setProcessing:function(t,e){this.processing=!0===t,this.isProcessing()?(this.$container.addClass("loading"),this.loader=new n({loader:this.options.loader.params,idLoader:this.options.loader.idloader}),this.loader.add(this.$container.find(".modal-body"),e||this.options.loader.overlay)):(this.$container.removeClass("loading"),this.loader.end())},createModal:function(){var t=this.options.modal?this.options.modal:"";if(this.$container=l(this.html.body),this.$container.attr("id",this.options.target),this.$container.addClass(t),this.$container.children(".modal-dialog").addClass(this.options.size),this.$container.find(".modal-body").html(this.content),this.options.header){var e=l(this.html.header);e.find(".modal-title").html(this.options.header),this.$container.find(".modal-content").prepend(e)}"alert"!==this.options.modal||this.options.ajax?"confirm"!==this.options.modal||this.options.ajax||this.$container.find(".modal-content").append(this.html.footer.confirm):this.$container.find(".modal-content").append(this.html.footer.alert)},show:function(){this.$element&&this.$element.tooltip("hide"),this.$container.modal(h.options)}},h});