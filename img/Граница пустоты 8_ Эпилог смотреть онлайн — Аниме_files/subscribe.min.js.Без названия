define(["jquery","realTimeSocket"],function(i,t){"use strict";var e=function(){this.dialogId=[],this.threadId=[],this.user()};e.prototype={user:function(){t.emit("subscribeUser",user.id)},dialog:function(){var i=document.querySelectorAll("[data-dialog-init]");i&&Array.prototype.forEach.call(i,function(i){var e=parseInt(i.getAttribute("data-dialog-init"));isNaN(e)||this.dialogId.indexOf(e)<0&&(this.dialogId.push(e),t.emit("subscribeDialog",e))}.bind(this))},removeDialog:function(i){i=parseInt(i),isNaN(i)||this.dialogId.indexOf(i)>=0&&(this.dialogId.splice(this.dialogId.indexOf(i),1),t.emit("unsubscribeDialog",i))},removeDialogAll:function(){if(this.dialogId.length)for(var i in this.dialogId)t.emit("unsubscribeDialog",this.dialogId[i]),this.dialogId.splice(this.dialogId.indexOf(this.dialogId[i]),1)},thread:function(i){var e=parseInt(i.getAttribute("data-thread-init"));isNaN(e)||this.threadId.indexOf(e)<0&&(this.threadId.push(e),t.emit("subscribeThread",e))},removeThread:function(i){i=parseInt(i),isNaN(i)||this.threadId.indexOf(i)>=0&&(this.threadId.splice(this.threadId.indexOf(i),1),t.emit("unsubscribeThread",i))}};var a=new e;return i(document).on("requireajax.un.shown",".chat",function(){a.dialog()}).on("click",".mini-chat-close",function(){var t=i(this).closest(".chat-block").data("dialog-init");a.removeDialog(t)}).on("close.un.chat active.un.dialog_list",function(i){a.removeDialog(i.id)}).on("requireajax.un.show",".message-new-btn",function(){a.removeDialogAll()}).on("requireajax.un.shown","[data-thread-init]",function(i){a.thread(i.target)}),a});